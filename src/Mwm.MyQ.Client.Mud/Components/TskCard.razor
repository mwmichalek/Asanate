@inherits Mwm.MyQ.Client.Mud.Components.ModelConsumerComponent<TskModel, Tsk>
@using Mwm.MyQ.Client.Service.Models
@using Mwm.MyQ.Domain
@using MudBlazor
<MudCard Outlined="true"
         Class="m-2">
    <!--Style="width: 300px;"-->
    <MudCardHeader Style="@HeaderStyle" Class="p-2">
        <CardHeaderContent>
            <MudGrid>
                @if (IncludeCompanyName) {
                    <MudItem xs="8">
                        <MudText Typo="Typo.h6" Color="Color.Surface">
                            @TskModel.CompanyName > @TskModel.InitiativeName
                        </MudText>
                    </MudItem>
                } else {
                    <MudItem xs="8">
                        <MudText Typo="Typo.h6" Color="Color.Surface">
                            @TskModel.InitiativeName 
                        </MudText>
                    </MudItem>
                }
                @if (@TskModel.InitiativeExternalLink != null) {
                    <MudItem xs="4" Class="justify-end">
                        <MudLink Target="_blank" 
                                 Href="@TskModel.InitiativeExternalLink" 
                                 Typo="Typo.body2">
                            @TskModel.InitiativeExternalId
                        </MudLink>
                    </MudItem>
                }
            </MudGrid>
            <MudText Typo="Typo.h5">@TskModel.Name</MudText>
        </CardHeaderContent>
    </MudCardHeader>
    @if (!string.IsNullOrEmpty(TskModel.Notes)) {
        <MudCardContent>
            <MudText>@TskModel.Notes</MudText>
            <MudDivider />
        </MudCardContent>
    }
    <MudCardActions>
        <MudGrid>
            <MudItem xs="2" Class="d-flex justify-start">
                @if (!string.IsNullOrEmpty(HourProgressDisplay)) {
                    <MudChip Size="Size.Medium" 
                             Variant="Variant.Outlined" 
                             Color="@Color.Info">
                        @HourProgressDisplay
                    </MudChip>
                }
            </MudItem>
            <MudItem xs="6" Class="d-flex justify-start">
                @if (!string.IsNullOrEmpty(DueDateDisplay)) {
                    <MudChip Size="Size.Medium" 
                             Variant="Variant.Text" 
                             Color="@DueDateCountColor">
                        @DueDateDisplay 
                        <MudChip Size="Size.Small" 
                             Variant="Variant.Outlined" 
                             Color="@DueDateCountColor">
                            @DueDateCount
                        </MudChip>
                    </MudChip>
                }
            </MudItem>
            <MudItem xs="4" Class="d-flex justify-end">
                <MudIconButton Icon="@Icons.Filled.MoreTime" 
                               OnClick="@(() => ShowActivityForm(true))"
                               Size="Size.Small" 
                               aria-label="Add more time"/>
                <MudPopover  Class="" 
                         Open="@ActivityFormIsVisible" 
                         AnchorOrigin="Origin.BottomCenter" 
                         TransformOrigin="Origin.TopCenter"
                         Variant="Variant.Text" 
                         Color="@Color.Default">
                    <div class="d-flex align-center m-1 p-1">
                        <MudNumericField Label="Duration Estimate (Hrs)"
                                                @bind-Value="ActivityModel.Duration"
                                                HelperText=""
                                                Variant="Variant.Text" 
                                                Min="0"  
                                                Max="8"
                                                Format="F2"
                                                Step="0.25F"
                                                For="@(() => ActivityModel.Duration)"
                                                />
                    </div>
                    <div class="d-flex align-center m-1 p-1">
                        <MudDatePicker Label="Date" 
                                            Editable="true" 
                                            @bind-Date="ActivityModel.StartTime" 
                                            Placeholder="Select Date" 
                                            For="@(() => ActivityModel.StartTime)"
                                             />
                    </div>
                    <div class="d-flex align-center m-1 p-1">
                        <MudTextField Label="Notes" 
                                            @bind-Value="ActivityModel.Notes"
                                            HelperText=""
                                            Variant="Variant.Text" 
                                            For="@(() => ActivityModel.Notes)"
                                             />
                    </div>
                    <div class="d-flex align-right m-1 p-1">
                        <MudIconButton Icon="@Icons.Filled.Save" 
                                       Color="Color.Success" 
                                       Size="Size.Small" 
                                       aria-label="save"
                                       OnClick="@(() => SaveActivity())" />
                        <MudIconButton Icon="@Icons.Filled.Cancel" 
                                       Color="Color.Error" 
                                       Size="Size.Small" 
                                       aria-label="save"
                                       OnClick="@(() => ShowActivityForm(false))" />
                    </div>
                </MudPopover >

                @if (TskModel.Status == Status.Done) {
                    <MudToggleIconButton @bind-Toggled="@IsArchived"
                         Icon="@Icons.Filled.Archive" 
                         Color="@Color.Default" 
                         Title="All Statuses"
                         Size="Size.Small" 
                         ToggledIcon="@Icons.Filled.Archive" 
                         ToggledColor="@Color.Success" 
                         ToggledTitle="Action Statuses" 
                         ToggledSize="Size.Small" />
                } else {
                    <MudToggleIconButton @bind-Toggled="@IsDone"
                         Icon="@Icons.Filled.CheckBox" 
                         Color="@Color.Default" 
                         Title="All Statuses"
                         Size="Size.Small" 
                         ToggledIcon="@Icons.Filled.CheckBox" 
                         ToggledColor="@Color.Success" 
                         ToggledTitle="Action Statuses" 
                         ToggledSize="Size.Small" />
                }

                <MudToggleIconButton @bind-Toggled="@IsInFocus"
                         Icon="@Icons.Filled.Biotech" 
                         Color="@Color.Default" 
                         Title="All Statuses"
                         Size="Size.Small" 
                         ToggledIcon="@Icons.Filled.Biotech" 
                         ToggledColor="@Color.Success" 
                         ToggledTitle="Action Statuses" 
                         ToggledSize="Size.Small" />

                <MudIconButton Icon="@Icons.Filled.Edit" 
                        aria-label="Edit"
                        Size="Size.Small" 
                        OnClick="@Edit" />
            </MudItem>
        </MudGrid>
    </MudCardActions>
</MudCard>
