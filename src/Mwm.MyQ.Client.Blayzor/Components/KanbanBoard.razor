@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@using Mwm.MyQ.Client.Blayzor.Helpers;
@using Mwm.MyQ.Client.Blayzor.Models.Tsks
@using Mwm.MyQ.Domain;
@using Syncfusion.Blazor.Kanban
@using Syncfusion.Blazor.Layouts
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Cards
@using Mwm.MyQ.Client.Blayzor.Components;

@if (IsLoading()) {
    <div class="spinner-border" role="status">
        <span class="sr-only alert-light">Loading...</span>
    </div>
}
@if (HasErrors()) {
     <span class="text-light">Whoops! Looks like an issue occurred loading TskModels</span>
} else if (HasValues()) {
    <SfKanban @ref="refKanbanBoard" TValue="TskModel" KeyField="StatusName" @bind-DataSource="@TskModels">
        <KanbanColumns>
        @foreach (var statusName in StatusNames) {
            <KanbanColumn HeaderText="@statusName" KeyField="@statusName.ToKeyFields()"></KanbanColumn>
        }
        </KanbanColumns>
        <KanbanCardSettings HeaderField="Name" ContentField="Notes">
            <Template>
            @{
                <TskCard TskModel="(TskModel)context"
                         IncludeCompanyName="IsGroupedByCompany" />
            }
            </Template>
        </KanbanCardSettings>

        @if (IsGroupedByCompany) {
            <KanbanSwimlaneSettings KeyField="CompanyName" 
                                    TextField="CompanyName" 
                                    SortDirection="SortDirection.Ascending" />
        }
        <KanbanEvents DragStop="@DragStopHandler" DialogOpen="@DialogOpenHandler" TValue="Models.Tsks.TskModel"></KanbanEvents>
        <KanbanSortSettings SortBy="SortOrderBy.Index" Field="RankId"></KanbanSortSettings>
    </SfKanban>
}

<TskPopup @ref="TskPopup" />

<style>
    .e-kanban-header {
        margin-top: 10px;
    }

    .e-kanban {
        border-radius: 10px;
    }
</style>
