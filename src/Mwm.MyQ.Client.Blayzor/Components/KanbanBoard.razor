@inherits Mwm.MyQ.Client.Blayzor.Components.ModelConsumerComponent<TskModel, Tsk>
@using Mwm.MyQ.Client.Blayzor.Helpers
@using Mwm.MyQ.Client.Service.Models
@using Mwm.MyQ.Client.Service.Store.State.Shared
@using Mwm.MyQ.Domain;
@using Syncfusion.Blazor.Kanban
@using Syncfusion.Blazor.Layouts
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Cards
@using Mwm.MyQ.Client.Blayzor.Components

@if (IsLoading()) {
    <div class="spinner-border" role="status">
        <span class="sr-only alert-light">Loading...</span>
    </div>
} else if (HasErrors()) {
    <span class="text-light">Whoops! Looks like an issue occurred loading TskModels</span>
} else if (HasValues()) {
    <h2>@FilteredTskModels.Count()</h2>

    <SfKanban @ref="RefKanbanBoard" 
              TValue="TskModel" 
              KeyField="StatusName" 
              @bind-DataSource="@FilteredTskModels">
        <KanbanColumns>
        <!-- Would like to be able to remove this since its being done programmatically -->
        @foreach (var statusName in Statuses.Select(s => s.ToStr())) {
            <KanbanColumn HeaderText="@statusName" KeyField="@statusName.ToKeyFields()"></KanbanColumn>
        }
        </KanbanColumns>
        <KanbanCardSettings HeaderField="Name" ContentField="Notes">
            <Template>
            @{
                <TskCard TskModel="(TskModel)context"
                         IncludeCompanyName="!IsGroupedByCompany" />
            }
            </Template>
        </KanbanCardSettings>

        <!--KanbanEvents DragStop="@DragStopHandlerAsync" DialogOpen="@ShowTskEditor" TValue="TskModel"></!--KanbanEvents>
        <KanbanSortSettings-- SortBy="SortOrderBy.Index" Field="RankId"></KanbanSortSettings-->
    </SfKanban>
}

<TskPopup @ref="refTskPopup" />

<style>
    .e-kanban-header {
        margin-top: 10px;
    }

    .e-kanban {
        border-radius: 10px;
    }
</style>
