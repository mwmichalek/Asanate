@inherits Fluxor.Blazor.Web.Components.FluxorComponent
@using Mwm.MyQ.Client.Blayzor.Helpers;
@using Mwm.MyQ.Client.Blayzor.Models.Tsks
@using Mwm.MyQ.Domain;
@using Syncfusion.Blazor.Kanban
@using Syncfusion.Blazor.Layouts
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Cards
@page "/"
@page "/kanban"

<div class="row">
    <div class="col-lg-12">
        <div class="d-flex flex-row justify-content-center">
            @if (IsLoading()) {
                <div class="spinner-border" role="status">
                    <span class="sr-only alert-light">Loading...</span>
                </div>
            }
            @if (HasErrors()) {
                <span>Whoops! Looks like an issue occurred loading TskModels</span>
            } else if (HasValues()) {

                <SfKanban @ref="KanbanBoard" TValue="TskModel" KeyField="StatusName" @bind-DataSource="@TskModels">
                    <KanbanColumns>
                        @foreach (var statusName in StatusNames) {
                            <KanbanColumn HeaderText="@statusName" KeyField="@statusName.ToKeyFields()"></KanbanColumn>
                        }
                    </KanbanColumns>
                    <KanbanCardSettings HeaderField="Name" ContentField="Notes">
                        <Template>
                            @{
                                TskModel tskModel = (TskModel)context;

                                <Mwm.MyQ.Client.Blayzor.Components.TskCard TskModel="tskModel" />

                                <!--div-- class="card-template">
                                    <div class="e-card-header">
                                        <div class="e-card-header-caption">
                                            <small class="text-secondary card-card-subtitle">@tskModel.InitiativeName</small>
                                            <div class="e-card-header-title e-tooltip-text">@tskModel.Name</div>
                                        </div>
                                    </div>
                                    <div class="e-card-content" style="background-color: brown;">
                                        <div class="e-text e-tooltip-text">
                                            <div class="container">
                                                <div class="row">
                                                    <div class="col-2" style="background-color: blue;">
                                                        1
                                                    </div>
                                                    <div class="col-6" style="background-color: red;">
                                                        2
                                                    </div>
                                                    <div class="col-4" style="background-color: orange;">
                                                        3
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <div class="col-4">
                                                        <span class="badge rounded-pill bg-primary">4 / 10</span>
                                                    </div>
                                                    <div class="col-4">
                                                        <span class="text-light">12/01/2021</span>
                                                    </div>

                                                    <div class="col-4">
                                                        <a target="_blank" class="link-light" href="@tskModel.InitiativeExternalLink">@tskModel.InitiativeExternalId</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </!--div-->

                            }
                        </Template>
                    </KanbanCardSettings>

                    <KanbanSwimlaneSettings KeyField="CompanyName" TextField="CompanyName" SortDirection="SortDirection.Ascending">
                    </KanbanSwimlaneSettings>
                    <KanbanEvents DragStop="@DragStopHandler" DialogOpen="@DialogOpenHandler" TValue="Models.Tsks.TskModel"></KanbanEvents>
                </SfKanban>

            }
        </div>
    </div>
</div>

<Mwm.MyQ.Client.Blayzor.Components.TskPopup @ref="TskPopup" />

<style>
.e-kanban-header {
    margin-top: 10px;
}

.e-kanban {
    border-radius: 10px;
}
</style>
